
type Query {
    ## Tenants
    getRootTenant: Tenant!
    getTenants: [Tenant!]!
    getTenantById(tenantId: String!): Tenant

    ## Clients
    getClients(tenantId: String!): [Client!]!
    getClientById(clientId: String!): Client

    ## Users
    getUsers(tenantId: String): [User!]!
    getUserById(userId: String!): User
    
    
    ## Keys
    getSigningKeys(tenantId: String): [Key!]!
    getSigningKeyById(signingKeyId: String!): Key

    ## RateLimit
    getRateLimits(tenantId: String): [RateLimit!]!
    getRateLimitById(rateLimitId: String!): RateLimit


    ## Scope
    getScope(tenantId: String): [Scope!]!
    getScopeById(scopeId: String!): Scope


    ## LoginGroups
    getLoginGroups(tenantId: String): [LoginGroup!]!
    getLoginGroupById(loginGroupId: String!): LoginGroup!
    

    ## Groups
    getGroups: [Group!]!
    getUserGroups(userId: String!): [Group!]!
    
}

type Mutation {
    ## Tenants
    createRootTenant(tenantInput: TenantCreateInput!): Tenant
    updateRootTenant(tenantInput: TenantUpdateInput!): Tenant
    
    createTenant(tenantInput: TenantCreateInput!): Tenant
    updateTenant(tenantInput: TenantUpdateInput!): Tenant
    deleteTenant(tenantId: String!): String

    ## Clients
    createClient(clientInput: ClientCreateInput!): Client
    updateClient(clientInput: ClientUpdateInput!): Client
    ## Just returns the ID after deletion is complete
    deleteClient(clientId: String!): String

    ## Users

    
    ## Keys
    createSigningKey(keyInput: KeyCreateInput!): Key
    updateSigningKey(keyInput: KeyUpdateInput!): Key

    ## RateLimit
    createRateLimit(rateLimitInput: RateLimitCreateInput!): RateLimit
    updateRateLimit(rateLimitInput: RateLimitUpdateInput!): RateLimit
    deleteRateLimit(rateLimitId: String!): String
    assignRateLimitToTenant(tenantId: String!, rateLimitId: String!, allowUnlimited: Boolean, limit: Int, rateLimitPeriodMinutes: Int): TenantRateLimitRel
    updateRateLimitForTenant(tenantId: String!, rateLimitId: String!, allowUnlimited: Boolean, limit: Int, rateLimitPeriodMinutes: Int): TenantRateLimitRel
    removeRateLimitFromTenant(tenantId: String!, rateLimitId: String!): String

    ## Scope
    createScope(scopeInput: ScopeCreateInput!): Scope
    updateScope(scopeInput: ScopeUpdateInput!): Scope
    deleteScope(scopeId: String!): String
    assignScopeToTenant(tenantId: String!, scopeId: String!): TenantScopeRel
    removeScopeFromTenant(tenantId: String!, scopeId: String!): String
    assignScopeToClient(tenantId: String!, clientId: String!, scopeId: String!): ClientTenantScopeRel
    removeScopeFromClient(tenantId: String!, clientId: String!, scopeId: String!): String

    ## LoginGroups
    createLoginGroup(loginGroupInput: LoginGroupCreateInput!): LoginGroup
    updateLoginGroup(loginGroupInput: LoginGroupUpdateInput!): LoginGroup
    deleteLoginGroup(loginGroupId: String!): String!
    assignLoginGroupToClient(loginGroupId: String!, clientId: String!): LoginGroupClientRel
    removeLoginGroupFromClient(loginGroupId: String!, clientId: String!): String
    
    ## Groups
    createGroup(groupInput: GroupCreateInput!): Group
    updateGroup(groupInput: GroupUpdateInput!): Group
    deleteGroup(groupId: String!): String!
    addUserToGroup(userId: String!, groupId: String!): UserGroupRel
    removeUserFromGroup(userId: String!, groupId: String!): String

}

########
# 1.    tenantId -           Write once, read only
# 2.    enabled -            true | false
# 3.    allowedScopeValues - ALL of the scopes that are available for the tenant. A subset of these are
#                            available to each of the clients
# 4.    claimsSupported -    Of all of the OIDC claims, which does this tenant support
# 5.    allowUnlimitedRate - true | false. True will override any rate limit set in the rateLimits property

type Tenant {
    tenantId: String!
    tenantName: String!
    tenantDescription: String
    enabled: Boolean!
    claimsSupported: [String!]!
    allowUnlimitedRate: Boolean
    delegateAuthentication: Boolean!
    oidcClientDefinitionId: String
}

enum ClientAuthType {
    CLIENT_SECRET_POST
    CLIENT_SECRET_BASIC
    CLIENT_SECRET_JWT
    NONE
}

# Either client secret should be defined or usePkce should be set to true
# if no client secret, then client auth type should be NONE
# refreshTokenAllowed - does the external provider allow for refresh tokens? default false 
type OIDCClientDefinition {
    oidcClientDefinitionId: String!
    oidcClientName: String!
    oidcClientDescription: String
    oidcClientTenantId: String
    oidcProviderClientId: String!
    oidcProviderClientSecret: String
    oidcProviderWellKnownUri: String!
    refreshTokenAllowed: Boolean!
    usePkce: Boolean!
    clientAuthType: ClientAuthType
}


enum ClientType {
    SERVICE_ACCOUNT_ONLY
    SERVICE_ACCOUNT_AND_USER_DELEGATED_PERMISSIONS
    USER_DELEGATED_PERMISSIONS_ONLY
}


# 1.    tenantId -      Parent tenant (write once, read only)
# 2.    clientId -      GUID
# 3.    clientSecret -  A 256-bit hex-encoded value
# 4.    clientName
# 5.    clientDescription
# 6.    enabled -       true | false
# 7.    redirectUris - List of redirect URIs for authorization
# 8.    oidcEnabled -  Allow SSO for this client
# 9.    pkceEnabled
# 10.   clientType
# 11.   userTokenTTLSeconds default is 60 minutes, configurable up to 12 hours
# 12.   allowUserSelfRegistration default false
# 13.   allowDelegatedAuthentication default false
type Client {
    tenantId: String!
    clientId: String!
    clientSecret: String!
    clientName: String!
    clientDescription: String
    enabled: Boolean
    redirectUris: [String!]
    oidcEnabled: Boolean!
    pkceEnabled: Boolean!
    clientType: ClientType!
    userTokenTTLSeconds: Int
    allowUserSelfRegistration: Boolean!
    allowDelegatedAuthentication: Boolean!
}

type DomainOIDCClientDefinitionRel {
    domain: String!
    oidcClientDefinitionId: String!
}


type User {
    tenantId: String!
    userId: String!
    externalOIDCProviderSubjectId: String
    email: String!
    firstName: String!
    lastName: String!
    middleName: String
    phoneNumber: String
    address: String
    createdDate: String!
    updatedDate: String
    countryCode: String
    preferredLanguageCode: String    
}

type LoginGroup {
    tenantId: String!
    loginGroupId: String!
    loginGroupName: String!
    loginGroupDescription: String
}

type LoginGroupClientRel {
    clientId: String!
    loginGroupId: String!
}

type LoginGroupUserRel {
    loginGroupId: String!
    userId: String!
}

type Group {
    tenantId: String!
    groupId: String!
    groupName: String!
}

type UserGroupRel {
    userId: String!
    groupId: String!
}

type UserCredential {
    userId: String!
    salt: String!
    hashedPassword: String!
}

type UserCredentialHistory {
    userId: String!
    salt: String!
    hashedPassword: String!
    dateCreated: String!
}

type Key {
    tenantId: String!
    keyId: String!
    keyType: String!
    use: String!
    n: String!
    e: String!
    x5c: [String!]!
    exp: String!
}



# 1.    rateLimitId
# 2.    rateLimitDomain  -  User-defined name of the context or other identifier which will be used by the application
#                           to make rate limiting decisions. If you need just one then it can be global.
# 3.    rateLimitDescription  -  
type RateLimit {
    rateLimitId: String!
    rateLimitDomain: String!
    rateLimitDescription: String
}

type TenantRateLimitRel {
    tenantId: String!
    rateLimitId: String!
    allowUnlimitedRate: Boolean
    rateLimit: Int
    rateLimitPeriodMinutes: Int
}

type Scope {
    scopeId: String!
    scopeName: String!
    scopeDescription: String
}

type TenantScopeRel {
    tenantId: String!
    scopeId: String!
}

type ClientTenantScopeRel {
    tenantId: String!
    clientId: String!
    scopeId: String!
}



############################################################################
################ INPUT TYPES AND RESPONSES FOR MUTATATIONS #################
############################################################################

input OIDCClientDefinitionInput {
    tenantId: String!
    clientId: String!
    clientSecret: String
    wellKnownUri: String!
    usePkce: Boolean!
    clientAuthType: ClientAuthType
}

input TenantCreateInput {
    tenantName: String!
    tenantDescription: String
    enabled: Boolean!
    claimsSupported: [String!]!
    allowUnlimitedRate: Boolean
    delegateAuthentication: Boolean!
    delegatedOIDCClientDef: OIDCClientDefinitionInput
    emailDomains: [String!]
}

input TenantUpdateInput {
    tenantId: String!
    tenantName: String!
    tenantDescription: String
    enabled: Boolean!
    claimsSupported: [String!]!
    allowUnlimitedRate: Boolean
    delegateAuthentication: Boolean!
    delegatedOIDCClientDef: OIDCClientDefinitionInput
    emailDomains: [String!]
}

input ClientCreateInput {
    tenantId: String!
    clientName: String!
    clientDescription: String
    enabled: Boolean
    redirectUris: [String!]
    oidcEnabled: Boolean
    pkceEnabled: Boolean
    clientType: ClientType!
}

input ClientUpdateInput {
    tenantId: String!
    clientId: String!
    clientName: String!
    clientDescription: String
    enabled: Boolean
    redirectUris: [String!]
    oidcEnabled: Boolean
    pkceEnabled: Boolean
    clientType: ClientType!
}

input KeyCreateInput {
    tenantId: String!
    keyType: String!
    use: String!
    n: String!
    e: String!
    x5c: [String!]!
    exp: String!
}


input KeyUpdateInput {
    tenantId: String!
    keyId: String!
    keyType: String!
    use: String!
    n: String!
    e: String!
    x5c: [String!]!
    exp: String!
}

input RateLimitCreateInput {
    rateLimitDomain: String!
    rateLimitDescription: String
}

input RateLimitUpdateInput {
    rateLimitId: String!
    rateLimitDomain: String!
    rateLimitDescription: String
}
input ScopeCreateInput {
    scopeName: String!
    scopeDescription: String
}

input ScopeUpdateInput {
    scopeId: String!
    scopeName: String!
    scopeDescription: String
}

input LoginGroupCreateInput {
    tenantId: String!
    loginGroupName: String!
    loginGroupDescription: String
}

input LoginGroupUpdateInput {
    tenantId: String!
    loginGroupId: String!
    loginGroupName: String!
    loginGroupDescription: String
}

input GroupCreateInput {
    tenantId: String!
    groupName: String!
}

input GroupUpdateInput {
    tenantId: String!
    groupId: String!
    groupName: String!
}
